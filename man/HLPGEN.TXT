;
; Данный текст уже размечен для компиляции программой HELPGEN
; (запуск:  HELPGEN  hlpgen.txt ), но его можно и просто
; прочитать для получения представления о программировании
; и использовании итерактивных систем подсказки (HELP-ов).
;
MENU_WINDOW     1,3,60,18,2,13
selected_text   12
TEXT_WINDOW     2,4,48,16,14,10
Message         19,4,' Text window '
Message         24,3,' Menu window '
Message         20,20,' HELP on HELPGEN v1.0 '
selected_char   1
PageUp_button   51,2,'page~Up'
PageDn_button   51,4,'page~Dn'
Return_button   51,6,'~Return'
GoTop_button    51,8,' ~Gotop'
Search_button   51,10,'~Search'
List_button     51,12,' ~List '
Print_button    51,14,' ~Print'
Exit_button     51,16,' ~Exit '

<0>
 Используйте клавиши управления курсором для
 перемещения по тексту в текстовом окне и по
 "кнопкам" в окне меню. Вызывайте {"пояснения"}<10>
 установкой курсора на {выделенный} текст и нажатием
 на ENTER. В окне меню {"кнопки"}<7> активизируются
 при  нажатии  на  ENTER или при  нажатии вы-
 деленной буквы. Для возврата из пояснения
 нажмите  клавишу ESC. Переключение окон -
 клавиша ТАБ. Активное окно выделяется двойной
 рамкой. Клавиши {^C}<1>, {^R}<2>, {^U}<3>, {^T}<8> в текстовом
 окне действуют как в редакторе SED.  Также  в
 текстовом окне доступны клавиши {^L}<4>,{^P}<5>.
       Для ознакомления с программой
	       {HELPGEN V1.0}<18>
  HELP-система предлагает следующие разделы:
   -{Понятие компилятора и интерпретатора}<11>
   -{Основные объекты HELP-системы}<12>
   -{Синтаксис входного языка}<13>
   -{Команды конфигурации HELP-системы}<14>
   -{Обработка исходного текста}<15>
   -{Запуск программы и использование результатов}<20>
   -{Возможные ошибки компиляции}<16>
   -{Требования к аппаратуре и базовому ПО}<21>
   -{От авторов}<17>
<0>
<1>
Нажатие {клавиши}<6> ^C в текстовом окне приводит к
перемещению просматриваемого текста на страницу
вниз по тексту. (Пролистывание текста удобно
для обзора).
<1>
<2>
Нажатие {клавиши}<6> ^R в текстовом окне приводит к
перемещению просматриваемого текста на страницу
вверх по тексту. (Пролистывание текста удобно
для обзора).
<2>
<3>
Нажатие {клавиши}<6> ^U в текстовом окне приводит к
перемещению к правому краю просматриваемого текста.
<3>
<8>
Нажатие {клавиши}<6> ^T в текстовом окне приводит к
перемещению к левому краю просматриваемого текста.
<8>
<4>
Нажатие {клавиши}<6> ^L в текстовом окне приводит к
перемещению к началу просматриваемого текста
(или пояснения), т.е. текущего фрагмента.
<4>
<5>
Нажатие {клавиши}<6> ^P в текстовом окне приводит к
печати текущего текстового фрагмента на принтер.
Встроенная процедура печати анализирует готовность
принтера и  при его неготовности выдает соответ-
ствующее сообщение.
<5>
<6>
   Здесь под выражением "клавиша" понимается
одновременное нажатие клавиш CTRL (CONTROL или УС)
и соответствующей символьной клавиши на латинском
регистре (или нажатие CTRL и не отпуская ее -
символьной клавиши). Например, клавиша ^C
получается при комбинации CTRL и C.
<6>
<7>
В данном описании под выражением    └└└└└└└└©
"кнопки" понимаются графические    Ё {K}нопка Ё°
объекты в окнах меню.Эти объекты   ─└└└└└└└└≥⌡
переключаются курсорными клави-      ÷÷÷÷÷÷÷÷÷
шами (текущий отмечается выделенным цветом и
направленными на него стрелками) и  активизируются
при нажатии на клавишу ENTER или соответствующей
выделенной буквы (которая обычно заглавная). Для
"кнопки"  на  рисунке выделенная буква - "К".
В окне меню Help-системы имеются следующие кнопки:
 'pageUp' - на страницу вверх  (как ^R в текстовом окне)
 'pageDn' - на страницу вниз   (как ^C в текстовом окне)
 'Return' - выход из пояснения (как ESC в текстовом окне)
 'Gotop'  - на начало Help-системы
 'Search' - {поиск подстроки}<9>
 'List'   - {список выделенных фраз}<19> (глоссарий)
 'Print'  - печать текущего текстового фрагмента (темы)
 'Exit'   - выход из HELP-системы
<7>
<9>
   В некоторых случаях бывает необходимо найти
какую-либо тему по известной подстроке или в
пределах текущей темы найти предложение, содержащее
подстроку.  В этом случае удобно воспользоваться
системой поиска подстроки. Нажав "кнопку" 'Search'
в окне меню Вы попадете в  диалоговое окно системы
поиска. Для ввода  новой  подстроки  (если старое
значение не устраивает) нажмите  TAB.  Завершить
ввод подстроки можно нажав на ENTER. Далее "нажмите"
одну из кнопок:
   'All text' - для поиска во всех текстовых  фрагментах
   'Current'  - для поиска в текущем текстовом фрагменте
   'Abort'    - для выхода из системы поиска
  Система поиска не различает регистры и алфавиты.
Для нее строки 'stroka' и 'СТРОКА' одинаковы, что
позволяет искать совпаления с подстрокой на любом
регистре.  Если подстрока найдена или не найдена,
система выдаст соответствующие сообщения.
<9>
<10>
   Данная HELP-система оперирует структурированными
данными. Это значит, что данные(текст) разбиты на
группы по смыслу, которые некоторым образом связаны
между  собой. Пример такой связи - пара "термин -
разъяснение термина", которая названа "пояснением".
В этом случае "термин"-выделенная цветом фраза
текста, которая содержит ссылку на поясняющий текст.
Поэтому если подвести  курсор к выделенной фразе и
нажать на ENTER, HELP-система выведет на экран
поясняющий фрагмент текста. При этом она запомнит
откуда был вызов, и при нажатии ESC осуществит
возврат к предыдущему тексту. Такой механизм поз-
воляет осуществить  многократную  вложенность
"пояснений". При входе в "пояснение" в левом верхнем
углу текстового окна  появляется индикатор (знак
"стрелка вверх") того, что из текущего текстового
фрагмента возможен возврат в "над-фрагмент".
   Примечание: Выделенный фрагмент не обязательно
имеет ссылку на текст, бывают выделенные фразы,
нажатие ENTER на которых не приведет к выводу
пояснения.
<10>
<11>
   Программ HELPGEN состоит из 2-х основных
частей : компилятора и интерпретатора.  В
данном случае под {компилятором} понимается
процедура, осуществляющая перевод информации,
представленной на входном языке, в представление,
удобное для последующей ее интерпретации
(исполнения). Под {интерпретатором} понимается
процедура, осуществляющие выполнение неких
функций, основываясь на данных, подготовленных
компилятором.
   В выходном файле присутствуют только
интерпретатор и интерпретируемые им данные.
<11>
<12>
   В скомпилированном фрагменте можно выделить
ряд объектов : это средства интерфейса (окна,
текстовые надписи, {"кнопки"}<7>) и отображаемый
итерактивный текст. Текст считается итерактивным
(диалоговым), т.к. он {структурно}<10> представлен
и пользователь сам определяет (с клавиатуры), в
какой последовательности он будет просматривать
текст. Расположение и вид объектов интерфейса
можно задать(на этапе компиляции) любым.
<12>
<13>
   Входным (исходным) файлом для {компилятора}<11>
служит текстовый файл, специально размеченный,
и несущий в себе полное описание вида системы
и собственно выводимый текст. Соответственно,
входной файл состоит из {команд конфигурации}<14> и
{текста}<15>, в котором установлены необходимые связи.
Во входном тексте можно использовать любые ASCII
символы, следует только помнить, что символы
<<,{{,}} в определенных случаях могут быть
интерпретированы системой как спец-символы.
<13>

<14>
   Общий вид команды конфигурации:
"идентификатор"+"разделитель"+"список параметров"
  = "идентификатор" - это название того элемента,
    параметры которого устанавливаются в этом
    выражении
  = "разделитель" - цепочка пробелов и (или)
    кодов табуляции
  = "список параметров" - несколько цифр (1..6)
    и (или) текстовых строк (в апострофах),
    записанных через запятую

Команды конфигурации (набираются на любом
регистре):

MENU_WINDOW     x,y,dx,dy,textcolor,backcolor
  определяет вид окна управления :
  расположение - x,y - левый верхний угол окна
		 dx,dy - размеры окна
     минимальный и максимальный размеры окон
     ограничены.
  {цвет}<23> -  textcolor, backcolor (0..15)
  Все эти параметры должны находиться в рамках
  {параметров экрана}<22>

SELECTED_CHAR   textcolor
  определяет {цвет}<23> выделенных букв "кнопок"

TEXT_WINDOW     x,y,dx,dy,textcolor,backcolor
  аналогично окну управления

SELECTED_TEXT   textcolor
  определяет {цвет}<23> выделенного текста

MESSAGE         x,y,' STRING '
  выводит на экран надпись ' STRING ', начиная
  с позиции (x,y). Эти параметры должны находиться
  в рамках {параметров экрана}<22>

XXXXXX_BUTTON   mx,my,'~String'
  Определяет "кнопку" внутри окна управления.
  "Кнопка" имеет надпись 'String' (буква, перед
  которой стоит знак ~ выделяется, сам знак ~ не
  выводится на экран. Параметры mx,my определяют
  позицию кнопки внутри окна управления и должны
  находить в рамках этого окна. Текст строки
  может быть и на русском и на латинском регистре.
     В реальном тексте вместо XXXXXX подставить
  идентификатор кнопки (отражающий ее функцио-
  нальное назначение - кнопки связаны с соответ-
  ствующими {процедурами}<7>). Варианты:
     - PAGEUP(_BUTTON) - на страницу вверх
     - PAGEDN          - на страницу вниз
     - GOTOP           - на начальную страницу
     - RETURN          - выход из {пояснения}<10>
     - SEARCH          - поиск подстроки
     - LIST            - список выделенных фраз
     - PRINT           - печать текущего фрагмента
     - EXIT            - выход из HELP-системы

  Кнопок может быть любое количество. Однако,
  если нет кнопки EXIT, то выйти из HELP-а не
  удастся.
<14>
<15>
    Перед разметкой текста его желательно отфор-
матировать (напр, программой FTX производства
BLACK CAT inc.), т.к. после разметки из-за
наличия в тексте служебных символов форматирование
не принесет нужных результатов.
Для обеспечения {структурированности текста}<10>,
исходный текст размечается (делится) на фрагменты
(темы). Для обозначения начала и конца фрагмента
применяютя метки (цифры в треугольных скобках).
     Пример:
  <<0>
    Тема 0
    Тема 0
  <<0>
   Сразу за командами конфигурации в исходном
тексте должна идти тема 0 , содержащая ссылки
на другие темы. Их номера могут быть любыми в
пределах 1..250. Если необходимо выделить фразу,
ее надо заключить в фигурные скобки, если
нужно, чтобы эта выделенная фраза указавала на
другую тему, то за закрывающей фигурной скобкой
надо написать метку нужной темы.
     Пример:
  <<0>
    Тема 0
    {{Идти к теме 3}}<<3>
    Тема 0
  <<0>
  <<3>
    Тема 3
  <<3>
  Темы могут быть вложенными, т.е. текст,
составляющий тему, может быть частью более
крупной темы, например:
  <<3>
    Тема 3
  <<6>
    Тема 3&6
    Тема 3&6
  <<6>
    Тема 3
  <<3>

  Символы <<,{{,}} интерпретируются системой
как спец-символы. Если в тексте необходимо иметь
эти скобки как простые символы, их надо ввести
дважды.
  Программа скомпилирует столько текста, сколько
влезает в TPA. Размер строк не должен превышать
255 символов, в тексте не должно быть более
9999 строк.
<15>
<16>
  В процессе компиляции могу быть найдены
ошибки из-за несоблюдения пользователем правил
построения входного текста. При этом HELP-система
выдаст соответствующее сообщение и укажет номер
строки (0..9999), в которой была найдена ошибка.
  Кроме ошибок компиляции сущетвуют ошибки
времени исполнения (Run time error), которые
могут возникнуть в ходе выполнения HELP-а из-за
переполнения стека вложенности {пояснений}<10>,
из-за наличия указателя на несуществующую тему
или если тема не имеет конца(закрывающей метки).
<16>
<17>
  Данная HELP-система была разработана мною
(С.Акимовым) в 1996 году. На ее проектирование
было затрачено около 1 месяца, зато с ее помощью
можно делать красивые приложения за минимальное
время.
  Создание инструментальных средств - вот то
направление, в котором по мнению автора необходимо
работать программистам.
     (c) & (p) Black Cat inc. 1996.
<17>
<20>  <18>
  Программа HELPGEN предназнечена для создания
систем итерактивных подсказок. Запуск:
  HELPGEN  inpfile.ext  xorcode
<18>
  inpfile.ext - имя (и расширение, если есть)
		входного файла
  xorcode     - есть возможность "поксорить"
		текст, который будет получен
		после компиляции (для затрудне-
		ния его несанкционированной
		модификации).
  При удачной компиляции, HELPGEN запишет на
диск файл с именем как у входного файла и с
расширением HLP. Поэтому не делайте входной
файл с расширением HLP (в этом случае он будет
перезаписан).
  Полученный HLP файл можно использовать в любых
своих программах, работающих в TPA. Для этого
надо просто загрузить HLP файл в память и
передать управление CALL-ом на адрес загрузки.
HLP файл сам определяет куда его загрузили и
корректирует свое тело. HLP-файл работает по
стеку вызывающей программы (т.е. стек должен
иметь запас) и возвращает управление командой
RET. HLP не восстанавливает ни экран, ни цветной
режим, об этом должна позаботиться вызывающая
программа. HLP файл имеет опознаватель формата-
строку 'HLP' в первых 3-х байтах файла.
  HLP файл представляется как COM-файл путем
простой замены расширения (переименованием).
<20>
<19>
   При нажатии на "кнопку" LIST пользователь
получает список всех выделенных фраз, имеющих
ссылки на другие темы . Этот список может быть
сортированным или несортированным. Клавишами
управления курсором можно выбрать любую фразу
и прочитать соответствующую ей тему.
   Примечание: в версии 1.0 этот режим не
реализован.
<19>
<21>
   Для нормальной работы HELP системы должны
быть выполнены требования к аппаратуре:
   необходимо наличие Z80
Необходимое базовое ПО: ОС СРМ любой версии
(желательно Altair-DOS 3.xx, BEST-DOS 2.xx),
Обязательно наличие {полной} версии цветного
драйвера консоли 480C (существуют кастрированные
версии, из которых некие придурки выкинули коды
управления автопереводом строки, а система ими
пользуется - и ведет себя на таких драйверах
неалгоритмично. Вот эти искейп-коды:
   ESC,'4' - включить автоперевод строки
   ESC,'5' - выключить автоперевод строки
Эти коды существуют с 94 года (AltairDos 1.0)
и никто не имеет права их выкидывать).
<21>
	<22>
   HELP-система для своей работы использует
60-символьный режим драйвера (60 символов в
строке, 25 строк, символы 8-битные, 16-цветный
режим {цветного}<23> драйвера (mode 2)), поэтому
координаты объектов интерфейса должны быть
такими, чтобы эти объекты не выходили за
границы экрана.
<22>
<23>
   Полная таблица цветов для 16-цветного режима:
Код    Цвет                Код    Цвет
 0   черный    (black)      8   серый           (gray)
 1   голубой   (blue)       9   светло-голубой  (lightblue)
 2   зеленый   (green)     10   светло-зеленый  (lightgreen)
 3   синий     (cyan)      11   светло-синий    (lightcyan)
 4   красный   (red)       12   светло-красный  (lightred)
 5   малиновый (magenta)   13   светло-малиновый(lightmagenta)
 6   коричневый(brown)     14   желтый          (yellow)
 7   белый     (white)     15   интенсивно-белый(brightwhite)
<23>




 ен превышать
255 символов, в тексте не должно быть более
9999 строк.
<15>
<16>
  В 