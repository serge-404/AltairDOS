 Orionsoft  1995                                        PIP.COM
----------------------------------------------------------------


		    PIP - копирование и слияние файлов.


    Программа PIP позволяет копировать файлы, создавать новые файлы, вы-
водить файлы на печать и на перфоленту.


    Загрузка
   ----------

    Программа PIP находится на диске в виде файла PIP.COM и занимает 8К.
Она инициируется вводом одной из следующих командных строк пкк:

	  PIP                                                      (1)
	  PIP "командная строка PIP"                               (2)

     В случае (1) программа PIP загружается в память, выдает на консоль
сообщение "*" и ждет ввода командной строки PIP, которую немедленно выпол-
няет. Затем опять выдается сообщение "*" и т.д. Командные строки PIP выпо-
лняются до тех пор, пока не будет введена пустая командная строка или пока
не будет сделан "горячий старт" (управляющий символ ^C).

     В случае (2) PIP загружается в память, автоматически выполняет един-
ственную командную строку PIP и завершается без выдачи дополнительного со-
общения на консоль.


     Командная строка PIP
    ----------------------

  Командная строка программы PIP имеет следующий формат:

      "приемник"="источник1","источник2",...,"источникN"

"Приемник" и каждый из "источников" могут быть:

    - именем дискового файла с необязательным заданием имени диска;
    - именем диска;
    - именем устройства (логического или физического);
    - дополнительным именем.

     После каждого из перечисленных имен в командной строке PIP должно
идти двоеточие (:).

     Кроме того, к каждому "источнику" могут задаваться параметры копиро-
вания. Подробнее об этих параметрах говорится ниже.

     Общая длина командной строки не должна превышать 256 символов. Для
строк, превышающих ширину экрана, физический возврат каретки задается уп-
равляющим символом ^E.

     Символы, введенные в нижнем регистре, внутри программы преобразуются
в символы верхнего регистра для согласования с именами файлов и устройств
ОС CP/M.

     Ниже приводится список логических и физических устройств, с которыми
работает программа PIP.

     Логические устройства:

     CON          - консоль;
     RDR          - устройство ввода;
     PUN          - устройство вывода;
     LST          - печатающее устройство.

     Физические устройства:

     TTY          - консоль, устройство ввода, вывода или текстовое
                    устройство;
     CRT          - консоль или текстовое устройство;
     UC1          - консоль;
     PTR          - устройство ввода с перфоленты;
     UP1          - устройство чтения;
     UP2          - устройство чтения;
     LPT          - печатающее устройство;
     PTP          - устройство вывода на перфоленту.

     Фактическое использование конкретных физических устройств зависит
от конкретного аппаратного окружения [2].

     Устройство-"приемник" должно уметь принимать данные (т.е. Нельзя пе-
ресылать данные на RDR), а устройство-"источник" должно уметь вырабаты-
вать данные (т.е. нельзя LST использовать для чтения).

     В командных строках программы PIP можно также задавать следующие до-
полнительные имена:

     NUL          - переслать на устройство-"приемник" 40 нулей (0 кода,
		    принятого в ОС CP/M); это может служить признаком кон-
		    ца вывода на перфорацию;

     EOF          - переслать символ конца файла ОС CP/M (^Z) на устройст-
		    во-"приемник" (посылается автоматически в конце всех
                    данных, передаваемых программой PIP);

     INP          - специальный входной "источник", который может быть
                    введен в программу PIP:
                    PIP посимвольно получает входные данные, обращаясь по
                    команде CALL к ячейке 0103H и получая данные в ячейке
		    109H (бит четности, т.е. старший бит должен быть 0);

     OUT          - специальный "приемник" вывода, который может быть вве-
                    ден в программу PIP:
                    PIP обращается по команде CALL к ячейке 106H, при этом
                    каждый передаваемый символ находится в регистре C.
                    Ячейки с адресами от 109H до 1FFH не используются в
                    образе памяти PIP и в них с помощью программы DDT,
                    описанной в [4], можно поместить драйверы специального
                    назначения;

     PRN          - эквивалентно LST с той разницей, что в позиции каждо-
                    дого восьмого символа устанавливается табуляция, стро-
                    ки нумеруются и после каждых 60 строк устанавливается
                    прогон страницы (с начальным прогоном).

     Общие принципы работы программы PIP
    --------------------------------------

     Имена файлов и устройств в командах PIP могут чередоваться. Каждый
раз копирование с заданного устройства происходит до тех пор, пока не бу-
дет прочтен признак конца файла (^Z для символьных файлов и реальный конец
файла для прочих дисковых файлов).

     Данные с каждого устройства или файла копируются слева направо, пока
не будет считан последний файл-"источник". Данные из исходных файлов запи-
сываются в устройство или файл-"приемник"; для символьных файлов в конец
добавляется символ конца файла ^Z. Всегда предполагается, что файлы типа
.COM не являются символьными.

     Процесс копирования в любой момент можно прервать, введя с консоли
любой символ (условие прерывания). На это PIP выдает сообщение "ABORTED",
показывающее, что операция не закончена. При внезапном прекращении любой
операции или при возникновении в процессе работы ошибки PIP удаляет все
команды, установленные программой SUBMIT [5].


     Работа с дисковыми файлами
   -----------------------------

     При работе с дисковыми файлами в случае, если имя диска не задано,
предполагается активизированный в данный момент диск.

     При слиянии нескольких файлов в один программа PIP предполагает, что
все файлы-"источники" - символьные и что признаком конца каждого файла
служит управляющий символ ^Z. Параметр копирования O (см.  ниже)
позволяет игнорировать это предположение. Этим параметром можно воспользо-
ваться для слияния файлов, не являющихся символьными, например, типа .COM.

     При копировании с диска на диск файлы-"источники" сохраняются. Прог-
грамма PIP создает временный файл-"приемник" типа $$$, который получит имя
файла-"приемника" только при успешном завершении копирования.

     При слиянии нескольких дисковых файлов в файл-"приемник", находящийся
на том же диске, имя файла-"приемника" может совпадать с именем одного из
файлов-"источников". Файл-"источник" не изменится до тех пор, пока не бу-
дет завершено слияние. Если возникает какая-либо ошибка, файл-"источник"
не затирается.

     Для большего удобства пользователя PIP допускает возможность массо-
вого копирования с одного диска на другой. Это достигается заданием в ко-
мандной строке в качестве имени файла или(и) типа файла символа "*", а
также файловых ссылок.

     Примеры допустимых операций копирования и слияния дисковых файлов:

NEW.ZOT=B:OLD.ZAP                скопировать файл OLD.ZAP с диска B в
				 файл NEW.ZOT на активизированном диске;

X.ASM=Y.ASM,Z.ASM,X.ASM          создать файл X.ASM из об'единения файлов
				 Y.ASM, Z.ASM, X.ASM. Все файлы находятся
				 на активизированном диске. Файлы Y.ASM,
                                 Z.ASM не изменяются. Файл X.ASM изменится
                                 только по успешном окончании копирования;


B:A.U=B:B.V,A:C.W,D.X            слить файл B.V, находящийся на диске B,
                                 с файлом C.W, находящимся на диске A, и
                                 с файлом D.X, находящимся на активизиро-
                                 ванном диске. Результирующий файл A.U бу-
                                 дет на диске B. Файлы-"источники" остану-
                                 тся неизменными;

B:=*.COM                         копировать все файлы типа COM с активизи-
                                 рованного диска на диск B;

A:=B:ZAP.*                       Копировать с диска B: на диск A: файлы
                                 всех типов с именем ZAP;

A:=B:*.*                         Копировать с диска B: на диск A: все файлы.

     В случае массового копирования программа PIP выдает на консоль имена
всех копируемых файлов.

     Если на диске, куда производится копирование, уже есть файл с именем
файла-"приемника", то при успешном завершении копирования он затирается, а
вместо него записывается скопированный файл.



     Работа с логическими и физическими устройствами
    -------------------------------------------------

     Rабота программы PIP с логическими и физическими устройствами анало-
гична работе с дисками, поэтому в этом подразделе речь идет лишь об одном
частном случае, а также приводятся примеры.

     В случае, когда "приемником" служит файл типа HEX (файл шестнадцати-
ричных машинных кодов), а "источником" является устройство ввода с перфо-
ленты, программа PIP осуществляет специальные действия. Она проверяет, со-
держит ли файл-"источник" допустимые шестнадцатеричные значения и записи
контрольных сумм. При обнаружении ошибочной входной записи программа PIP
выдает на консоль сообщение об ошибке и ждет коррекции. Для коррекции обы-
чно бывает достаточно повторить ввод участка перфоленты (для этого надо
переместить перфоленту назад на 50 см). Когда лента готова для повторного
ввода, нужно ввести управляющий символ CR, и программа PIP повторит попыт-
ку ввода. Если же данный участок не может быть считан, то надо просто про-
должить ввод (введя управляющий символ CR сразу за сообщением об ошибке),
а данную запись ввести с консоли с помощью редактора текстов ED после
того, как файл на диске уже создан. Для большего удобства PIP позволяет
вводить конец файла с консоли, если исходный файл берется с устройства
RDR:. В этом случае программа PIP осуществляет ввод с устройства и управ-
ляет консолью. Если с консоли будет введен управляющий символ ^Z, то опе-
рация ввода заканчивается нормально.


     Примеры допустимых командных строк PIP для работы с логическими и фи-
зическими именами устройств:

     PIP LST:=X.PRN              скопировать файл X.PRN с активизирован-
                                 ного диска на устройство LST и закончить
                                 работу PIP;

     PIP                         инициация PIP (PIP выдает запрос "*");

     CON:=X.ASM,Y.ASM,Z.ASM      слить три файла типа ASM и скопировать
                                 их на устройство CON;

     X.HEX=CON:,Y.HEX,PTR:       создать файл X.HEX, читая с устройства
                                 CON, (пока не введется ^Z), затем из
                                 файла Y.HEX на активизированном диске,
                                 затем с PTR (пока не встретится ^Z).

     CR                          конец работы PIP;

     PIP PUN:=NUL:,X.ASM,
	      EOF:,NUL:          вывести на перфоленту 40 нулей, потом
                                 скопировать файл X.ASM с активизирован-
                                 ного диска, вывести конец файла ^Z, затем
                                 вывести 40 нулей.


     Параметры копирования
    -------------------------

     Пользователь может задавать для программы PIP один или несколько па-
раметров, заключенных в квадратные скобки. Параметры могут разделяться
пробелами. Каждый параметр задает режим операции копирования. Список па-
раметров в скобках должен следовать сразу за файлом или устройством-"ис-
точником", к которому он относится.

     Далее приводится список параметров копирования:

     DN           удалить символы, которые выходят за колонку N при пере-
                  даче данных от "источника" к "приемнику". Этот параметр
                  чаще всего используется для укорачивания длинных строк
                  при передаче на консоль или узкое печатающее устройство;

     E            эхо на консоли всех операций передачи по мере их выпол-
                  нения;

     F            подавление установленных форматов подачи из файла. Одно-
		  временно с этим параметром можно использовать параметр P
		  для установки новых форматов подачи;

     H            проверка правильности файлового формата при копировании
                  шестнадцатеричных данных. Удаляются все недопустимые
                  символы, встречающиеся между шестнадцатеричными запися-
                  ми. При возникновении ошибок на консоль выдается сообще-
                  ние для проведения коррекции;

     I            игнорировать "00" - записи в передаваемом шестнадцатери-
                  чном формате (параметр I автоматически устанавливает
                  формат H);

     L            перекодировать символы верхнего регистра в символы ниж-
                  него регистра;

     N            нумерация строк. Нумерация начинается с единицы и увели-
                  чивается каждый раз на 1. Ведущие нули номера строки
                  опускаются, а после номера идет двоеточие. Если задан
                  параметр N2, то включаются ведущие нули и вслед за номе-
                  ром устанавливается табуляция. Табуляция будет расшире-
                  на, если установлен параметр T;

     O            передача об'ектного (не символьного) файла: игнорируется
		  принятый в ОС CP/M признак конца файла ^Z;

     PN           подача страницы после каждых N строк (с начальной уста-
                  новкой строки). Если N=1 или отсутствует, то подача
                  страницы происходит через каждые 60 строк. Если исполь-
                  зуется параметр F, то перед установкой новой страницы
                  подавляется формат подачи;

     QS^Z         прекращение копирования из файла или устройства-"источ-
                  ника" при обнаружении строки S, оканчивающейся ^Z;

     SS^Z         начать копирование при обнаружении строки S, оканчиваю-
                  щейся управляющим символом ^Z. Параметры Q и S можно ис-
		  пользовать для копирования части файла. Строки, опреде-
                  ляющие начало и конец копирования, всегда копируются.
                  Если PIP была вызвана командной строкой формата (2), то
		  строки, следующие за параметрами Q и S, процессор кон-
                  сольных команд перекодирует в символы верхнего регистра.
                  При использовании формата (1) перекодировки не происхо-
                  дит.

     TN           при передаче символов от "источника" к "приемнику" в
                  каждой N-й колонке устанавливается табуляция (управляю-
                  щий символ ^I);

     U            перекодировать символы нижнего регистра в символы верх-
                  него регистра;

     V            проверка правильности копирования с помощью чтения после
                  записи ("приемником" должен быть файл на диске);

     Z            для каждого символа, принятого в ОС CP/M кода, на входе
		  установить бит четности равным 0.


Примеры правильного задания параметров копирования файлов:

PIP X.ASM=B:[V]                  копировать файл X.ASM с диска B на акти-
                                 визированный диск с проверкой чтением
                                 после записи.

PIP LST:X.ASM[NT8U]              копировать файл X.ASM на устройство LST,
                                 перенумеровать строки, установить табуля-
                                 цию в каждой 8-й колонке, перекодировать
                                 символы нижнего регистра в символы верх-
                                 него регистра.

PIP PUN:=X.HEX[I],Y.ZOT[H]       сначала копировать на устройство PUN
                                 файл X.HEX с подавлением замыкающих запи-
                                 сей "00", потом копировать данные из фай-
                                 ла Y.ZOT, содержащего шестнадтцатеричные
                                 записи, не исключая записи "00".

PIP X.LIB=Y.ASM[SSUBR1:^Z        копировать в файл X.LIB из файла Y.ASM,
            QJMP L3^Z]           начиная со строки "SUBR1:" и кончая стро-
                                 кой "JMP L3" включительно.

PIP PRN:=X.ASM[P50]              переслать файл X.ASM с активизированного
                                 диска на устройство LST с нумерацией
                                 строк, табуляцией в каждой 8-й колонке и
                                 прогоном страницы после каждых 50 строк;
                                 по умолчанию для файла на устройстве PRN
                                 предполагается параметр NT8P60; P50 изме-
                                 няет это значение.


     Сообщения, выдаваемые программой PIP
   ---------------------------------------

     В процессе работы программы PIP могут выдаваться следующие сообще-
ния:

DISK READ ERROR                 ошибка при чтении с диска;

DISK WRITE ERROR                ошибка при записи на диск;

VERIFY ERROR                    ошибка при копировании с проверкой;

NOT A CHARACTER SINK            введен неверный символ;

READER STOPPING                 устройство чтения не включено;

NOT A CHARACTER SOURCE          источник не является символьным;

ABORTED                         прерывание с консоли;

BAD PARAMETER                   неверный параметр;

RECORD TOO LONG                 слишком длинная запись;

INVALID DIGIT                   неверная цифра;

END OF FILE, CTL-Z?             Конец файла, ввести ^Z ? ;

CHEKSUM ERROR                   ошибка в контрольной сумме;

CORRECT ERROR, TYPE RETURN      ошибка коррекции, введите CR или ^Z;
OR CTL-Z

INVALID FORMAT                  неверный формат;

NO DIRECTORY SPACE              нет места в каталоге;

NO FILE                         нет файла;

START NOT FOUND                 начало копирования (параметр S) не найдено

QUIT NOT FOUND                  конец копирования (параметр Q) не найден

CANNOT CLOSE DESTINATION FILE   файл-приемник не может быть закрыт;

DESTINATION IS R/O, DELETE      приемник в режиме "только чтение". Пода-
(Y/N)                           вить ?;

**NOT FOUND**                   не найдено;

COPYING -                       копирование (далее выдаются имена копируе-
                                мых файлов);

UNRECOGNIZED DESTINATION        неопознанный источник;

CANNOT RECORD                   запись невозможна;

INVALID PIP FORMAT              неверный формат программы PIP;

CANNOT READ                     чтение невозможно;

INVALID SEPARATOR               неверный разделитель.


       -------------------------------------------------------------
